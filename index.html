<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spiral Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="collapse.css">
</head>
<body>
    <div class="editor-panel">
        <h1>Spiral Editor</h1>
        
        <!-- New categorized preset layout -->
        <div class="preset-categories">
            <div class="preset-category">
                <div class="category-title">Spirals</div>
                <button class="main-preset-btn" onclick="loadPreset('ying_yang_spiral')">Ying Yang</button>
                <select class="preset-dropdown" onchange="loadPresetFromDropdown(this, 'spirals')">
                    <option value="">More spirals...</option>
                    <option value="dot_spiral">Dot Spiral</option>
                    <option value="double_spiral">Double Spiral</option>
                    <option value="fibonacci_spiral">Fibonacci Spiral</option>
                    <option value="galaxy_spiral">Galaxy Spiral</option>
                    <option value="vortex">Vortex</option>
                </select>
            </div>
            
            <div class="preset-category">
                <div class="category-title">Circles</div>
                <button class="main-preset-btn" onclick="loadPreset('tunnel')">Tunnel</button>
                <select class="preset-dropdown" onchange="loadPresetFromDropdown(this, 'circles')">
                    <option value="">More circles...</option>
                    <option value="concentric_circles">Concentric Circles</option>
                    <option value="orbit_dance">Orbit Dance</option>
                    <option value="ripple_effect">Ripple Effect</option>
                    <option value="kaleidoscope">Kaleidoscope</option>
                    <option value="flower_circles">Flower Circles</option>
                </select>
            </div>
            
            <div class="preset-category">
                <div class="category-title">Objects</div>
                <button class="main-preset-btn" onclick="loadPreset('stopwatch')">Stopwatch</button>
                <select class="preset-dropdown" onchange="loadPresetFromDropdown(this, 'objects')">
                    <option value="">More objects...</option>
                    <option value="pendulum">Pendulum</option>
                    <option value="mandala">Mandala</option>
                    <option value="particules">Particles</option>
                    <option value="crystal_formation">Crystal Formation</option>
                    <option value="floating_spheres">Floating Spheres</option>
                </select>
            </div>
            
            <div class="preset-category">
                <div class="category-title">Chill</div>
                <button class="main-preset-btn" onclick="loadPreset('waves')">Wave Pattern</button>
                <select class="preset-dropdown" onchange="loadPresetFromDropdown(this, 'chill')">
                    <option value="">More chill...</option>
                    <option value="night_sky">Night Sky</option>
                    <option value="aurora">Aurora</option>
                    <option value="zen_garden">Zen Garden</option>
                    <option value="ocean_flow">Ocean Flow</option>
                    <option value="meditation_orb">Meditation Orb</option>
                </select>
            </div>
            
            <div class="preset-category">
                <div class="category-title">Others</div>
                <button class="main-preset-btn" onclick="loadPreset('petals')">Petals</button>
                <select class="preset-dropdown" onchange="loadPresetFromDropdown(this, 'others')">
                    <option value="">More effects...</option>
                    <option value="text_example">Text Example</option>
                    <option value="center_pulse">Center Pulse</option>
                    <option value="glitch_art">Glitch Art</option>
                    <option value="cosmic_dust">Cosmic Dust</option>
                </select>
            </div>
        </div>
        
        <div class="layers-container">
            <div class="layer-controls-top">
                <button class="add-layer-btn" onclick="addLayer()">+ Add Layer</button>
                <div class="background-color-control">
                    <label for="backgroundColorPicker">BG:</label>
                    <input type="color" id="backgroundColorPicker" value="#000000" onchange="updateBackgroundColor(this.value)">
                </div>
                <button class="pip-btn" onclick="openPipWindow()" id="pipBtn">Open PiP</button>
            </div>
            <div id="layersContainer">
                <!-- Layers will be added here dynamically -->
            </div>
        </div>
        <div id="errorDisplay" class="error-display"></div>
        <div id="canvasContainer"></div>
    </div>
    
    <div class="preview-panel">
        <button class="collapse-btn" id="collapseBtn" onclick="toggleCollapse()">
            <span class="collapse-icon">›</span>
        </button>
        <div class="collapsible-content">
        <div class="preview-container">
            <div class="controls">
                <button onclick="runWithoutLag()">Run</button>
                <button onclick="stopAnimation()">Stop</button>
                <button onclick="clearCode()">Clear</button>
                <span id="status" style="color: #00cc66;"></span>
            </div>
            
            <div class="export-controls">
                <button onclick="exportGif()" id="exportGifBtn" disabled>Export GIF</button>
                <button onclick="exportWebP()" id="exportWebPBtn" disabled>Export WebP</button>
                <button onclick="exportMP4()" id="exportMP4Btn" disabled>Export MP4</button>
                <span id="exportStatus" style="margin-left: 10px; color: #ffaa00; font-size: 12px;"></span>
            </div>
            
            <div class="animation-controls">
                <div class="control-group">
                    <label for="framesInput">Frames:</label>
                    <input type="number" id="framesInput" value="120" min="10" max="1000" onchange="updateAnimationSettings()">
                </div>
                <div class="control-group">
                    <label for="fpsInput">FPS:</label>
                    <input type="number" id="fpsInput" value="60" min="1" max="120" onchange="updateAnimationSettings()">
                </div>
                
                <div class="control-group">
                    <label for="speedInput">Speed:</label>
                    <input type="number" id="speedInput" value="1" min="0.1" max="5" step="0.1" onchange="updateAnimationSettings()">
                </div>
            </div>
            
            <div class="progress-bars">
                <div class="frame-controls">
                    <button class="frame-btn" id="prevFrameBtn" onclick="previousFrame()">‹</button>
                    <input type="range" id="frameSlider" min="0" max="120" value="0" oninput="scrubToFrame(this.value)">
                    <button class="frame-btn" id="nextFrameBtn" onclick="nextFrame()">›</button>
                    <button class="frame-btn pause-btn" id="pauseFrameBtn" onclick="pauseAnimation()" disabled>⏸</button>
                    <span id="frameDisplay" class="frame-counter">000/120</span>
                </div>
                <div>
                    <div class="progress-label">Export Progress</div>
                    <div class="progress-container">
                        <div class="progress-bar export-progress" id="exportProgressBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="size-controls">
                    <div style="margin-bottom: 8px;">
                        <button class="size-btn active" onclick="setCanvasRatio('1:1')">Square (1:1)</button>
                        <button class="size-btn" onclick="setCanvasRatio('4:3')">Desktop (4:3)</button>
                        <button class="size-btn" onclick="setCanvasRatio('3:4')">Phone (3:4)</button>
                    </div>
                    <div class="size-slider-container">
                        <input type="range" class="size-slider" id="sizeSlider" min="300" max="1000" value="300" oninput="updateCanvasSize(this.value)">
                        <input type="number" class="size-input" id="sizeInput" min="300" max="1000" value="300" onchange="updateCanvasSizeFromInput(this.value)">
                        <span class="size-label">px</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load JavaScript files in proper order -->
	<script src="syntax-highlighter.js"></script>
    <script src="canvas.js"></script>
	<script src="layers.js"></script>
    <script src="controls.js"></script>
    <script src="export.js"></script>
    <script src="presets.js"></script>
    <script src="pip.js"></script>
</body>
</html>